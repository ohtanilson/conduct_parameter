\documentclass[11pt, a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath,setspace,geometry}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage[shortlabels]{enumitem}
\usepackage{rotating}
\usepackage{pdflscape}
\usepackage{graphicx}
\usepackage{bbm}
\usepackage[dvipsnames]{xcolor}
\usepackage{hyperref}
\hypersetup{colorlinks=true, linkcolor= BrickRed, citecolor = BrickRed, filecolor = BrickRed, urlcolor = BrickRed, hypertexnames = true}
\usepackage[]{natbib} 
\bibpunct[:]{(}{)}{,}{a}{}{,}
\geometry{left = 1.0in,right = 1.0in,top = 1.0in,bottom = 1.0in}
\usepackage[english]{babel}
\usepackage{float}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{tikz}
\usepackage{booktabs}
\usepackage{pdfpages}
\usepackage{threeparttable}
\usepackage{lscape}
\usepackage{bm}
\setstretch{1.4}
%\usepackage[tablesfirst,nolists]{endfloat}

\newtheorem{theorem}{Theorem}
\newtheorem{assumption}{Assumption}
\newtheorem{lemma}{Lemma}
\newtheorem{definition}{Definition}
\newtheorem{proposition}{Proposition}
\newtheorem{claim}{Claim}
\newtheorem{corollary}{Corollary}
\newtheorem{example}{Example}
\DeclareMathOperator{\rank}{rank}


\title{An MPEC Estimator for Conduct Parameter Estimation in Homogeneous Goods Markets: The Case of Log-linear Specification}
\author{Yuri Matsumura\thanks{Department of Economics, Rice University. Email: Yuri.Matsumura@rice.edu} \and Suguru Otani \thanks{Department of Economics, Rice University. Email: so19@rice.edu
%Declarations of interest: none %this is for Economics Letters
}}

\begin{document}

\maketitle
\begin{abstract}
    We propose a constrained Generalized Method of Moments (GMM) estimator for estimating conduct parameters in homogeneous goods markets. We formulate the estimation as an MPEC (Mathematical Programming with Equilibrium Constraints) problem incorporating theoretical conditions for the unique existence of an equilibrium price. 
    %Our approach avoids complex transformations based on equilibrium conditions and enables a broader range of specifications. 
    Monte Carlo simulations confirm that the proposed estimator performs better for estimating conduct parameters with a small Root-Mean-Squared-Error, for the typical specification, i.e., the log-linear model.
\end{abstract}


\section{Introduction}
Measuring competitiveness is one of the important tasks in empirical industrial organization literature.
Conduct parameter is considered to be a useful measure of competitiveness. 
However, it cannot be directly measured from data because data usually lack information about marginal cost.
Therefore, researchers endeavor to identify and estimate the conduct parameter.

As the simplest specification, \citet{bresnahan1982oligopoly} considers identification of conduct parameters for the linear model. \cite{matsumura2023resolving} resolves the conflict on some identification problems between \cite{bresnahan1982oligopoly} and \cite{perloff2012collinearity}. 
On the other hand, researchers may want to implement a different set of specifications such as the log-linear model, e.g., \cite{okazaki2022excess} and \cite{merel2009measuring}. As for the log-linear model, the identification strategy is provided by \citet{lau1982identifying}. 
Estimation problems arise for the case, however, when searching parameters using standard solvers because the equilibrium condition given by demand and supply curves involves log-transformation. 
This is an obstacle to choosing better specification of the demand and supply functions.

To overcome the problem, we propose a new estimator based on the mathematical program with equilibrium constraints (MPEC) approach advocated by \cite{su2012constrained}. 
MPEC is a constrained optimization problem whose constraint structure contains equilibrium constraints. 
First, we show theoretical conditions under which there is a unique equilibrium price given the log-linear specification.
Second, we show that MPEC estimator taking into account the conditions performs better for estimating conduct parameters than the standard approach such as Two-Stage-Least-Square using derivative or non-derivative solvers for the log-linear model.
We also show that increasing the sample size improves the accuracy of estimation.
We conclude that MPEC enables us to estimate a broader set of specifications which are identified theoretically shown in \cite{lau1982identifying} but practically and numerically difficult to estimate.


\section{Model}
Consider data with $T$ markets with homogeneous products.
Assume that there are $N$ firms in each market.
Let $t = 1,\ldots, T$ be the index of markets.
Then, we obtain the supply equation as follows:
\begin{align}
     P_t = -\theta\frac{\partial P_t(Q_{t})}{\partial Q_{t}}Q_{t} + MC_t(Q_{t}),\label{eq:supply_equation}
\end{align}
where $Q_{t}$ is the aggregate quantity, $P_t(Q_{t})$ is the demand function, $MC_{t}(Q_{t})$ is the marginal cost function, and $\theta\in[0,1]$, which is the conduct parameter. 
The equation nests perfect competition $(\theta=0)$, Cournot competition $(\theta=1 / N)$, and perfect collusion $(\theta=$ $1)$. See \cite{bresnahan1982oligopoly}.

Consider an econometric model of the above model.
Assume that the demand function and the marginal cost function are written as follows: 
\begin{align}
    P_t = f(Q_{t}, Y_t, \varepsilon^{d}_{t}, \alpha) \label{eq:demand}\\
    MC_t = g(Q_{t}, W_{t}, \varepsilon^{c}_{t}, \gamma)\label{eq:marginal_cost}
\end{align}
where $Y_t$ and $W_{t}$ are the vector of exogenous variables, $\varepsilon^{d}_{t}$ and $\varepsilon^{c}_{t}$ are the error terms, and $\alpha$ and $\gamma$ are the vector of parameters.
We also have the demand- and supply-side instrument variables $Z^{d}_{t}$ and $Z^{c}_{t}$, and assume that the error terms satisfy the mean independence condition $E[\varepsilon^{d}_{t}\mid Y_t, Z^{d}_{t}] = E[\varepsilon^{c}_{t} \mid W_{t}, Z^{c}_{t}] =0$. Note that $Z_t^d$ often is $W_t$ and $Z_t^c$ often is $Y_t$.

\subsection{Log-linear demand and log-linear marginal cost}
Consider the most typical specification which is nonlinear-in-parameters as the log-linear model.
Assume that log-linear demand and cost functions are specified as:
\begin{align}
    \log P_{t} &= \alpha_0 - (\alpha_1 + \alpha_2 Z^{R}_{t}) \log Q_t + \alpha_3 \log Y_t + \varepsilon^{d}_{t},\label{eq:log_linear_demand}\\
    \log MC_t &= \gamma_0 + \gamma_1 \log Q_t +  \gamma_2 \log W_{t} + \gamma_3 \log R_t + \varepsilon^{c}_{t}.\label{eq:log_linear_marginal_cost}
\end{align}
where $Y_{t}$ is an excluded demand shifter, $W_t$ and $R_t$ are excluded cost shifters, and $Z_t^R$ is Bresnahan's demand rotation instrument.
Since $\partial P_t/\partial Q_t = - (\alpha_1 + \alpha_2 Z_{t}^R) (P_t/Q_t) $, Equation \eqref{eq:supply_equation} is written as:
\begin{align}
    P_t &= \theta (\alpha_1 + \alpha_2 Z^{R}_{t}) P_t + MC_t.\label{eq:log_linear_supply_equation_direct}
\end{align}
By reformulating this and taking logarithm, $\log P_t(1 -\theta (\alpha_1 + \alpha_2 Z^{R}_{t})) = \log MC_t.$
Then, we obtain:
\begin{align}
    \log P_t = - \log(1 - \theta(\alpha_1 + \alpha_2 Z^{R}_{t})) + \gamma_0 + \gamma_1 \log Q_t +  \gamma_2 \log W_{t} + \gamma_3 \log R_t + \varepsilon^{c}_{t}. \label{eq:log_linear_supply_equation}
\end{align}

%An obstacle to estimate parameters is log-transformation in Equation \eqref{eq:log_linear_supply_equation}. First, the standard numerical algorithm faces invalid errors when evaluating the term, $\log (1 - \theta (\alpha_1 + \alpha_2 Z^{R}_{t}))$, whose inner candidate value, $(1 - \theta (\alpha_1 + \alpha_2 Z^{R}_{t}))$, is negative. The problem is inevitable because the true values of parameters are unknown. As in practical situations, researchers may want to use multiple rotation demand instruments or conduct parameters varied with time- or market- fixed effects.\footnote{See \cite{michel2018estimating} for the case of differentiated goods markets.} Then, the problem regarding the term becomes severer because the number of parameters within the log term increases. Second, if researchers may want to specify the demand function as $P_t=\alpha_0-\left(\alpha_1+\alpha_2 Z_t^R\right) Q_t+\alpha_3 Y_t+\varepsilon_t^d$, then the supply equation \eqref{eq:log_linear_supply_equation} is changed to $P_t=\theta \alpha_2 Z_t^R Q_t+\theta \alpha_1Q_t+\exp(\gamma_0+\gamma_1 \log Q_t+\gamma_2 \log W_t+\gamma_3 \log R_t+\varepsilon_t^c)$ which is nonlinear in cost parameters and conduct parameter $\theta$. 
%When constructing moment conditions, researchers face the above problem on log-transformation which limit researchers' alternative set of potential specifications.

An obstacle in estimation is log-transformation in Equation \eqref{eq:log_linear_supply_equation}.
The standard numerical algorithm stops with invalid errors when the inside of the log function, $1 - \theta (\alpha_1 + \alpha_2 Z^{R}_{t})$, becomes negative during the search for an optimizer.
When the term is negative, equilibrium prices do not exist. 
This problem is not specific to the above model and happens in other specifications such as a model with linear demand and log-linear marginal cost.

Explicitly, we derive the conditions for the number of equilibrium prices:

\begin{proposition}\label{prop:equilibrium_existence}
    Let $\Xi = \gamma_0 + \gamma_1\frac{\alpha_0 + \alpha_3 \log Y_t + \varepsilon^{d}_{t}}{\alpha_1 + \alpha_2 Z^{R}_{t}} +  \gamma_2 \log W_{t} + \gamma_3 \log R_t + \varepsilon^{c}_{t}$.
    The number of equilibrium prices $P_t^*>0$ is determined as follows:
    \begin{itemize}
        \item When $1 - \theta (\alpha_1 + \alpha_2 Z^{R}_{t}) \le 0$, there is no equilibrium price,
        \item When $1 - \theta (\alpha_1 + \alpha_2 Z^{R}_{t}) >0$, 
        \begin{itemize}
            \item If $-\gamma_1/(\alpha_1+\alpha_2 Z^R) =1$, there are infinitely many equilibrium prices when $\exp(\Xi) = 1 - \theta (\alpha_1 + \alpha_2 Z^{R}_{t})$, but there is no equilibrium price otherwise,
            \item If $-\gamma_1/(\alpha_1+\alpha_2 Z^R) \ne 1$, there is a unique equilibrium price.
        \end{itemize}
    \end{itemize}
\end{proposition}
See online appendix for the proof and the detail.
The proof is not based on the optimization by individual firms but checks if there exists a point where the demand function and the marginal cost function cross.
Therefore, we allow an equilibrium
price to exist when the demand and the marginal cost are upward-sloping.
We will impose some parameter restrictions on the demand and marginal cost later to exclude such unrealistic demand and marginal cost.



% \subsection{Log-linear demand and log-quadratic marginal cost}
% Next, we consider more nonlinear specification.
% Assume that the cost function is a log-quadratic form specified as:
% \begin{align}
%     \log MC_t &= \gamma_0 + \gamma_1 \log Q_t + \tilde{\gamma}_1 (\log Q_t)^{2} +  \gamma_2 \log W_{t} + \gamma_3 \log R_t + \varepsilon^{c}_{t}.
% \end{align}
% Then, the log aggregate quantity $\log Q_t $ is a solution of: 
% \begin{align}
%     (\log Q_t)^{2} + \frac{\gamma_1}{\tilde{\gamma}_{1}}\log Q_{t} +\frac{C}{\tilde{\gamma}_{1}} &= 0,
% \end{align}
% where $C=\alpha_0 + \alpha_3 \log Y_t + \log (1 - \theta (\alpha_1 + \alpha_2 Z^{R}_{t})) - \gamma_0  -  \gamma_2 \log W_{t} - \gamma_3 \log R_t + \varepsilon^{d}_{t} - \varepsilon^{c}_{t}$.
% Note that although this specification does not have an analytical solution, we can find numerically find a single positive solution.
\section{Estimation}

\subsection{Nonlinear system of 2SLS estimator}
To estimate parameters in the demand and supply equations, a standard approach is to use a GMM estimation.
Let $\xi = (\alpha_0,\alpha_1, \ldots, \alpha_3, \gamma_0,\gamma_1, \ldots, \gamma_3, \theta)$ be the vector of parameters in the demand and supply equations.

Given the demand equation \eqref{eq:log_linear_demand} and the supply equation \eqref{eq:log_linear_supply_equation}, we can write the error terms in the demand and supply equation as
\begin{align}
    {\varepsilon}_t^d(\xi) & =  \log P_{t} - \alpha_0 + (\alpha_1 + \alpha_2 Z^{R}_{t}) \log Q_t - \alpha_3 \log Y_t \label{eq:residual_demand_2sls}, \\
    {\varepsilon}_t^c(\xi) & =  \log P_t + \log_{t}(1 - \theta(\alpha_1 + \alpha_2 Z^{R}_{t})) -\gamma_0 - \gamma_1 \log Q_t -  \gamma_2 \log W_{t} -\gamma_3 \log R_t \label{eq:eq:residual_supply_2sls}.
\end{align}
To estimate the parameters, we convert the conditional moment conditions, $E[\varepsilon_t^d\mid Z_t^d] = E[\varepsilon_t^c\mid Z_t^c]=0$, into unconditional moment conditions, $E[\varepsilon_t^d Z_t^d] = E[\varepsilon_t^cZ_t^c]=0$.
Using Equations \eqref{eq:residual_demand_2sls} and \eqref{eq:eq:residual_supply_2sls}, we construct the sample analog of the moment conditions:
\begin{align*}
    g(\xi) = \left[\begin{array}{l}
    \frac{1}{T}\sum_{t=1}^T{\varepsilon}^{d}_{t}(\xi)Z_{t}^{d} \\
    \frac{1}{T}\sum_{t=1}^T{\varepsilon}^{c}_{t}(\xi)Z_{t}^{c}
    \end{array}\right].
\end{align*}
For some weighting matrix $W$, we define the GMM estimator as the vector $\xi^*$ that solves the problem,
\begin{align}
    \min_{\xi}\ g(\xi)^\top W g(\xi) \label{eq:minimization_gmm}. 
\end{align}
When we use a weight matrix such that
\begin{align}
    W = \left[\frac{1}{T}\sum_{t = 1}^T Z_t^\top Z_t\right]^{-1} \text{ where } Z_{t}=\left[\begin{array}{ll}
        Z_{t}^{d} & 0 \\
        0 & Z_{t}^{c}
    \end{array}\right],\label{eq:weight_matrix}
\end{align}
the solution to \eqref{eq:minimization_gmm} is called the nonlinear system 2SLS estimator (\cite{wooldridge2010econometric}, Section 14.2; hereafter N2SLS).
%We denote $\xi^{N2SLS}$ as the solution.


\subsection{MPEC estimator for the conduct parameter model}
We propose a novel and simple estimator for the log-linear conduct parameter model by utilizing the MPEC procedure advocated by \cite{su2012constrained}. Our setting is similar to \cite{dube2012improving} in which the GMM objective function with equilibrium constraints is constructed.

To construct the sample analog of the unconditional moments, we use the demand equation \eqref{eq:log_linear_demand} and the marginal cost function \eqref{eq:log_linear_marginal_cost} directly.
Then the residuals in the demand and supply equations are
\begin{align}
    \varepsilon_t^d(\xi) & =  \log P_{t} - \alpha_0 + (\alpha_1 + \alpha_2 Z^{R}_{t}) \log Q_t - \alpha_3 \log Y_t \label{eq:residual_demand_mpec}\\
    \varepsilon_t^c(\xi) & = \log MC_{t} - \gamma_0 - \gamma_1 \log Q_t -  \gamma_2 \log W_{t} - \gamma_3 \log R_t \label{eq:residual_supply_mpec}.
\end{align}
Note that we don't know the value of $MC_{t}$.
In the nonlinear system 2SLS, the value of $MC_{t}$ is recovered by using the first-order condition \eqref{eq:log_linear_supply_equation_direct} and we derived the supply equation based on the log-transformation of the first-order condition.
An MPEC estimator avoids this log-transformation problem by putting the first-order condition as an equality constraint and regarding $MC_t$ as a variable for the minimization problem.
We emphasize that while we focus on the log-linear specification, MPEC allows for more flexible specifications on the demand and supply equations.
Also, the programming cost of MPEC is lower than the standard approach because MPEC does not need analytical equilibrium expressions for constructing moment conditions.

By using the residuals in \eqref{eq:residual_demand_mpec} and \eqref{eq:residual_supply_mpec}, we define the MPEC estimator as the vector $\xi^{*}$ that solves the problem
\begin{align}
    &\min_{\xi, \{MC_t\}_{t=1}^T}\ g(\xi)^\top W g(\xi)\\
    \text{ s.t.}\quad & P_t = \theta (\alpha_1 + \alpha_2 Z^{R}_{t})P_t + MC_t,\quad t = 1,\ldots, T\\
    & 0 \le MC_t,\quad t = 1,\ldots, T\label{eq:positive_mc}.
\end{align}
Constraint \eqref{eq:positive_mc} is necessary because $\log MC_t$ becomes invalid when $MC_t$ is negative.
We can also use the same weight matrix \eqref{eq:weight_matrix} in the N2SLS.


\subsection{Other parameter constraints}
Based on the assumptions in Proposition \ref{prop:equilibrium_existence}, we also impose the following constraints for the estimation of the conduct parameter model:
\begin{align}
    &0\le\theta \le 1,\label{eq:condcut_constraint}\\
    &\alpha_1 + \alpha_2 Z_{t}^{R} >0, \quad \gamma_1>0 ,\quad t = 1,\ldots, T\label{eq:slope_constraint}\\
    &1- \theta(\alpha_1 + \alpha_2 Z_{t}^{R}) >0,\quad t = 1,\ldots, T.\label{eq:equlibrium_existence}
\end{align}
Constraint \eqref{eq:condcut_constraint} is a standard assumption on the conduct parameter.
Constraints \eqref{eq:slope_constraint} imply the downward slope of the demand curve and the upward slope of the marginal cost.
As we explained in Proposition \ref{prop:equilibrium_existence}, these are not necessary for the existence of an equilibrium price.
However, we impose them to make the demand equation and the supply equation realistic.
Constraints \eqref{eq:equlibrium_existence} are necessary to avoid searching parameters over the domain in which equilibrium prices do not exist. 

\section{Simulation results}\label{sec:results}

We compare MPEC estimation with the N2SLS.
We use state-of-the-art constrained optimization solvers, i.e., \texttt{Ipopt.jl} which implements an interior point line search filter method that aims to find a local solution of nonlinear programming problems.
Note that derivative-free algorithms such as Nelder-Mead algorithm cannot properly finish the optimization routine to solve the model because the above log-transformation problem arises even if the parameter search starts from the true values. See online appendix for the detailed numerical setting. 

%Second, we examine the Two-Stage-Least-Square (2SLS) model in which Ipopt is implemented for minimizing its supply side moments and the simultaneous equation model in which Ipopt is implemented for minimizing both demand and supply side moments. 
%We refer to the former as separate estimation and the latter as simultaneous estimation.
%These two estimation procedures are considered to be a middle ground between MPEC and standard approaches because these do not use equilibrium constraints but state-of-the-art constrained optimization solvers.

Table \ref{tb:loglinear_loglinear_sigma_1_simultaneous_non_constraint_theta_constraint_bias_rmse} presents the results.
First, as the sample size increases, the RMSE and bias decrease for both models. 
These magnitudes show comparable levels of the results of the linear model, shown in online appendix. 
Second, MPEC estimation gives smaller bias and RMSE than N2SLS for estimating a conduct parameter, although estimation of other parameters is comparable.
Third, MPEC can finish estimation for more data than N2SLS. 
This is the practical advantage of MPEC over the standard approach. 
With additional experiments under various $\sigma$, these results are robust, shown in online appendix. 
That is, MPEC is a better estimation approach than N2SLS.

\begin{table}[!htbp]
  \begin{center}
      \caption{MPEC vs N2SLS}
      \label{tb:loglinear_loglinear_sigma_1_simultaneous_non_constraint_theta_constraint_bias_rmse} 
      \subfloat[MPEC]{\input{figuretable/loglinear_loglinear_sigma_1_mpec_non_constraint_theta_constraint_bias_rmse}}\\
      % \subfloat[Separate]{\input{figuretable/loglinear_loglinear_sigma_0.5_separate_non_constraint_theta_constraint_bias_rmse}}\\
    \subfloat[N2SLS]{\input{figuretable/loglinear_loglinear_sigma_1_simultaneous_non_constraint_theta_constraint_bias_rmse}}
  \end{center}
  \footnotesize
  Note: The error terms in the demand and supply equation are drawn from a normal distribution, $N(0, \sigma)$. True values: $\alpha_0=20.0,\alpha_1=1.0,\alpha_2=0.1,\alpha_3=1.0,\gamma_0=5.0,\gamma_1=1.0,\gamma_2=1.0,\gamma_3=1.0,\theta=0.5$ and $\sigma=1.0$.
\end{table} 



\section{Conclusion}
We propose a constrained GMM estimator for conduct parameter estimation in homogeneous goods markets by formulating the estimation as an MPEC problem.
Our approach avoids the complex transformation within the equilibrium conditions and allows a broader set of specifications. 
To use MPEC approach, we first derive equilibrium conditions for the unique existence of an equilibrium price. 
Second, we conduct Monte Carlo simulations and confirm that MPEC estimator performs better than N2SLS for estimating conduct parameters. 
%We conclude that MPEC enables us to estimate a broader set of specifications which are identified theoretically shown in \cite{lau1982identifying} but practically and numerically difficult to estimate.
% We revisit the conduct parameter estimation in homogeneous goods markets.
% There is a conflict between \citet{bresnahan1982oligopoly} and \citet{perloff2012collinearity} in terms of identification and estimation.
% We highlight the problems in the proof and simulation in \citet{perloff2012collinearity}.
% Our simulation shows that the estimation of the conduct parameter becomes accurate by appropriately introducing demand shifters into the supply estimation and increasing the sample size. 
% Based on the theoretical and numerical investigation, we support the argument in \citet{bresnahan1982oligopoly}.


\paragraph{Acknowledgments}
We thank Jeremy Fox and Isabelle Perrigne for their valuable advice. This research did not receive any specific grant from funding agencies in the public, commercial, or not-for-profit sectors. 

\newpage
\bibliographystyle{aer}
\bibliography{conduct_parameter}

\newpage
\appendix

\section{Online appendix}\label{sec:appendix}
\subsection{Existence and uniqueness of equilibrium prices}
    Proposition \ref{prop:equilibrium_existence} proposes the conditions for the unique existence of $P_{t}(>0)$ solving the demand equation \eqref{eq:log_linear_demand} and supply equation \eqref{eq:log_linear_supply_equation} for $P_{t}$ under $\theta\in[0,1]$.
    \begin{proof}
        
    % \begin{align}
    %     \log P_{t} &= \alpha_0 - (\alpha_1 + \alpha_2 Z^{R}_{t}) \log Q_t + \alpha_3 \log Y_t + \varepsilon^{d}_{t},\\
    %     P_t &= \theta (\alpha_1 + \alpha_2 Z^{R}_{t}) P_t + MC_t\nonumber\\
    %     &=\theta (\alpha_1 + \alpha_2 Z^{R}_{t}) P_t + \exp(\gamma_0 + \gamma_1 \log Q_t +  \gamma_2 \log W_{t} + \gamma_3 \log R_t + \varepsilon^{c}_{t}).
    % \end{align}
    Rewriting the demand equation \eqref{eq:log_linear_demand} as 
    \begin{align*}
        \log Q_t^*(P_{t})= \frac{\alpha_0 - \log P_{t} + \alpha_3 \log Y_t + \varepsilon^{d}_{t}}{(\alpha_1 + \alpha_2 Z^{R}_{t})}   
    \end{align*}
    and substituting this into the supply equation \eqref{eq:log_linear_supply_equation}, we obtain
    \begin{align}
        P_t &=\theta (\alpha_1 + \alpha_2 Z^{R}_{t}) P_t + \exp\left(\gamma_0 + \gamma_1 \log Q^*_t(P_{t}) +  \gamma_2 \log W_{t} + \gamma_3 \log R_t + \varepsilon^{c}_{t}\right). \nonumber\\
        & = \theta(\alpha_1 + \alpha_2 Z^{R}_{t})P_t + \exp\left(\gamma_0 + \gamma_1 \frac{\alpha_0 - \log P_{t} + \alpha_3 \log Y_t + \varepsilon^{d}_{t}}{(\alpha_1 + \alpha_2 Z^{R}_{t})} +\gamma_2 \log W_{t} + \gamma_3 \log R_{t} + \varepsilon^{c}_{t} \right)\nonumber\\
        & = \theta(\alpha_1 + \alpha_2 Z^{R}_{t})P_t  + \exp\left(\Xi + \frac{-\gamma_1}{\alpha_1+\alpha_2 Z^{R}_t} \log P_t \right)\nonumber\\
        &= \theta(\alpha_1 + \alpha_2 Z^{R}_{t})P_t  + \exp(\Xi) P_t^{\frac{-\gamma_1}{\alpha_1 + \alpha_2 Z^{R}_{t}}}
    \end{align}
    where $\Xi = \gamma_0 + \gamma_1\frac{\alpha_0 + \alpha_3 \log Y_t + \varepsilon^{d}_{t}}{\alpha_1 + \alpha_2 Z^{R}_{t}} +  \gamma_2 \log W_{t} + \gamma_3 \log R_t + \varepsilon^{c}_{t}$.
    
    To find a fixed point of $P_{t}$, we define $\Delta(P_t)$ as follows:
    \begin{align}
        \Delta(P_t)
        %&=P_t -\left(\theta (\alpha_1 + \alpha_2 Z^{R}_{t}) P_t + \exp(\gamma_0 + \gamma_1 \log (\frac{\alpha_0 - \log P_{t} + \alpha_3 \log Y_t + \varepsilon^{d}_{t}}{(\alpha_1 + \alpha_2 Z^{R}_{t})}) +  \gamma_2 \log W_{t} + \gamma_3 \log R_t + \varepsilon^{c}_{t})\right)\\
        &= [1 - \theta (\alpha_1 + \alpha_2 Z^{R}_{t})]P_t - \exp(\Xi) P_t^{\frac{-\gamma_1}{\alpha_1 + \alpha_2 Z^{R}_{t}}}\label{eq:fixed_point}.
    \end{align}
    If $\frac{\partial\Delta(P_t)}{\partial P_t}$ is monotonically increasing at any $P_{t}> 0$ and $\Delta(\hat{P}_t)\cdot \Delta(\tilde{P}_t)<0$ for $0\le \hat{P}_t < \tilde{P}_t$, then a unique fixed point $P_t$ exists such that $\Delta(P_t)=0$ by the mean value theorem. 
    Note that the second term in \eqref{eq:fixed_point} is always positive regardless of the sign of $-\gamma_1/(\alpha_1+\alpha_2 Z^R)$ and the range is from zero to infinity on $P_t\ge 0$.
    
    When $1 - \theta (\alpha_1 + \alpha_2 Z^{R}_{t}) \le 0$.
    In this case, the first term in \eqref{eq:fixed_point} is always negative in $P_t >0$.
    Thus $\Delta(P_t)$ is also negative in $P_t>0$, which implies that there is no equilibrium point in the conduct parameter model.
    Hereafter, we assume that $1 - \theta (\alpha_1 + \alpha_2 Z^{R}_{t}) >0$, which implies that the first term is a straight line passing through the origin with a positive slope. 
    \begin{itemize}
        \item When $-\gamma_1/(\alpha_1+\alpha_2 Z^R) < 0$, the second term in \eqref{eq:fixed_point} is a monotone decreasing function in $P_t >0$. Since the first term is monotone increasing in $P_t >0$, the first term and second term cross only once on $P_t >0$, which implies that there is a unique equilibrium in the conduct parameter model.
        \item When $-\gamma_1/(\alpha_1+\alpha_2 Z^R) \in [0, 1)$, the second term becomes a monotone increasing concave function passing through the origin. Thus the first term and the second term cross only once on $P_t >0$.
        \item When $-\gamma_1/(\alpha_1+\alpha_2 Z^R) = 1$, \eqref{eq:fixed_point} becomes
        \[ 0 = [1 - \theta (\alpha_1 + \alpha_2 Z^{R}_{t}) - \exp(\Xi)] P_t. \]
        If $ 1 - \theta (\alpha_1 + \alpha_2 Z^{R}_{t}) = \exp(\Xi)$, as Equation \eqref{eq:fixed_point}  holds for any $P_t$, there are infinitely many fixed points on $P_t >0$, but there is no fixed point on $P_t >0$ otherwise.
        \item When $-\gamma_1/(\alpha_1+\alpha_2 Z^R) > 1$, the second term becomes a monotone increasing convex function passing through the origin. From $\Delta (P_t) = 0$, the fixed point can be written as 
        \begin{align}
            0 & = [1-\theta(\alpha_1 + \alpha_2 Z^{R}_{t})]P_t - \exp(\Xi) P_t^{\frac{-\gamma_1}{\alpha_1 + \alpha_2 Z^{R}_{t}}}\nonumber \\ 
            0 & = 1-\theta(\alpha_1 + \alpha_2 Z^{R}_{t}) - \exp(\Xi)P_t^{\frac{-\gamma_1}{\alpha_1 + \alpha_2 Z^{R}_{t}}- 1} \nonumber\\ 
            P_t^{\frac{-\gamma_1}{\alpha_1 + \alpha_2 Z^{R}_{t}}- 1} & = \frac{1-\theta(\alpha_1 + \alpha_2 Z^{R}_{t})}{ \exp(\Xi)}\nonumber\\ 
            P_t^{\frac{-\gamma_1 - \alpha_1 - \alpha_2 Z^{R}_{t}}{\alpha_1 + \alpha_2 Z^{R}_{t}}}&= \frac{1-\theta(\alpha_1 + \alpha_2 Z^{R}_{t})}{ \exp(\Xi)}\nonumber\\
            P_t^* &= \left(\frac{1-\theta(\alpha_1 + \alpha_2 Z^{R}_{t})}{\exp(\Xi)}\right)^{-\frac{\alpha_1 + \alpha_2 Z^{R}_{t}}{\gamma_1 +\alpha_1 + \alpha_2 Z^{R}_{t}}}.
        \end{align} 
        Since $1 - \theta (\alpha_1 + \alpha_2 Z^{R}_{t}) >0$ and $\exp(\Xi)>0$, $P^* >0$ is uniquely determined. Therefore, we have a unique fixed point on $P_t >0$.
    \end{itemize}
\end{proof}

Figure \ref{fg:equilibrium_existence} illustrates how the demand and supply equations cross under the conditions.
When $1- \theta(\alpha_1 + \alpha_2 Z^{R}_{t}) \le 0$, the supply equation \eqref{eq:log_linear_supply_equation} is ill-defined because the inside of the log function becomes negative.
Thus, there should not be any equilibrium.
Hereafter, assume that $1- \theta(\alpha_1 + \alpha_2 Z^{R}_{t}) > 0$.
When $-\gamma_1/(\alpha_1 + \alpha_2 Z^{R}_{t}) = 1$ and $\exp(\Xi) = 1- \theta(\alpha_1 + \alpha_2 Z^{R}_{t})$, the demand equation and supply equation coincides.
Thus there are infinitely many equilibria in the model.
When $-\gamma_1/(\alpha_1 + \alpha_2 Z^{R}_{t}) = 1$ and $\exp(\Xi) \ne 1- \theta(\alpha_1 + \alpha_2 Z^{R}_{t})$, the demand and supply equations have a same slope and different intercepts, which means that both equations become parallel.
Thus, there is no equilibrium.
When $-\gamma_1/(\alpha_1 + \alpha_2 Z^{R}_{t}) \ne 1$, the demand and supply equations have different slopes, and hence we can find a unique equilibrium. 


\begin{figure}[!ht]
    \caption{The illustrations of the equilibrium existence}
    \label{fg:equilibrium_existence}
    \begin{subfigure}{0.45\textwidth}
        \begin{tikzpicture}
            \draw[->,thick] (-0.5,0)--(4,0) node[right]{$Q_t$};
            \draw[->,thick] (0,-0.5)--(0,4) node[above]{$P_t$};
            \draw[blue, thick] (0,0.5) .. controls (1, 2.2)..(4,3) node[right]{$S$};
            \draw[red, thin] (0,0.5) .. controls (1, 2.2)..(4,3) node[above]{$D$};
        \end{tikzpicture}
         \caption{}
    \end{subfigure}
    \hfill
    \begin{subfigure}{0.45\textwidth}
        \begin{tikzpicture}
            \draw[->,thick] (-0.5,0)--(4,0) node[right]{$Q_t$};
            \draw[->,thick] (0,-0.5)--(0,4) node[above]{$P_t$};
            \draw[blue, thick] (0, 0.5) .. controls (1, 2.2)..(4,3) node[right]{$S$};
            \draw[red, thick, yshift = 5mm] (0, 0.5) .. controls (1, 2.2)..(4,3) node[right]{$D$};
        \end{tikzpicture}
        \caption{}
    \end{subfigure}
    
    \vspace{1em}
    \begin{subfigure}{0.45\textwidth}
        \begin{tikzpicture}
            \draw[->,thick] (-0.5,0)--(4,0) node[right]{$Q_t$};
            \draw[->,thick] (0,-0.5)--(0,4) node[above]{$P_t$};
            \draw[blue, thick] (0,0.5) .. controls (1, 2.2)..(4,3) node[right]{$S$};
            \draw[red, thick] (0,3.8) .. controls (1, 1.5) .. (4,1.0)  node[right]{$D$};
        \end{tikzpicture}
         \caption{}
    \end{subfigure}
    \hfill
    \begin{subfigure}{0.45\textwidth}
        \begin{tikzpicture}
            \draw[->,thick] (-0.5,0)--(4,0) node[right]{$Q_t$};
            \draw[->,thick] (0,-0.5)--(0,4) node[above]{$P_t$};
            \draw[blue, thick] (0,0.5) .. controls (1, 2.2)..(4,3.2) node[right]{$S$};
            \draw[red, thick] (0,1.4) .. controls (1, 2.2) .. (4,2.8)  node[below]{$D$};
        \end{tikzpicture}
         \caption{}
    \end{subfigure}
    \vspace{1em}
    \begin{subfigure}{0.45\textwidth}
        \begin{tikzpicture}
            \draw[->,thick] (-0.5,0)--(4,0) node[right]{$Q_t$};
            \draw[->,thick] (0,-0.5)--(0,4) node[above]{$P_t$};
            \draw[blue, thick] (0,3.0) .. controls (1, 2.0)..(4,1.5) node[right]{$S$};
            \draw[red, thick] (0,3.8) .. controls (1, 1.5) .. (4,1.0)  node[right]{$D$};
        \end{tikzpicture}
         \caption{}
    \end{subfigure}
    \hfill
    \begin{subfigure}{0.45\textwidth}
        \begin{tikzpicture}
            \draw[->,thick] (-0.5,0)--(4,0) node[right]{$Q_t$};
            \draw[->,thick] (0,-0.5)--(0,4) node[above]{$P_t$};
            \draw[red, thick] (0,0.5) .. controls (1, 2.2)..(4,3) node[right]{$D$};
            \draw[blue, thick] (0,3.8) .. controls (1, 1.5) .. (4,1.0)  node[right]{$S$};
        \end{tikzpicture}
         \caption{}
    \end{subfigure}
    
    \footnotesize
    Note: As there is no equilibrium when $1- \theta(\alpha_1 + \alpha_2 Z^{R}_{t}) \le 0$, the above figures assume that $1- \theta(\alpha_1 + \alpha_2 Z^{R}_{t}) > 0$. Case (a) considers the case $-\gamma_1/(\alpha_1 + \alpha_2 Z^{R}_{t}) = 1$ and $\exp(\Xi) = 1- \theta(\alpha_1 + \alpha_2 Z^{R}_{t})$. Case (b) considers the case $-\gamma_1/(\alpha_1 + \alpha_2 Z^{R}_{t}) = 1$ and $\exp(\Xi) \ne 1- \theta(\alpha_1 + \alpha_2 Z^{R}_{t})$. Case (c), (d), (e), and (f) consider the case $\gamma_1/(\alpha_1 + \alpha_2 Z^{R}_{t}) \ne 1$. Case (a) and (b) also allow both the demand and supply equations to be downward sloping.
\end{figure}



\newpage
\subsection{Simulation and estimation procedure}
We assess the performance of the MPEC estimator using Monte Carlo simulation.
To generate the simulation data, for each model, we first generate the exogenous variables $Y_t, Z^{R}_{t}, W_t, R_{t}, H_t$, and $K_t$ and the error terms $\varepsilon_{t}^c$ and $\varepsilon_{t}^d$ based on the data generation process in Table \ref{tb:parameter_setting}.
By substituting the Equation \eqref{eq:log_linear_demand} into Equation \eqref{eq:log_linear_supply_equation} and solving it for $P_{t}$, the log aggregate quantity is given as: 
\begin{align}
    \log Q_t &= \frac{ \alpha_0 + \alpha_3 \log Y_t + \log (1 - \theta (\alpha_1 + \alpha_2 Z^{R}_{t})) - \gamma_0  -  \gamma_2 \log W_{t} - \gamma_3 \log R_t + \varepsilon^{d}_{t} - \varepsilon^{c}_{t}}{\gamma_1+ \alpha_1 + \alpha_2 Z^{R}_{t} }.\label{eq:quantity_loglinear}
\end{align}
We compute the equilibrium quantity $Q_{t}$ for the log-linear model by \eqref{eq:quantity_loglinear}.
We then compute the equilibrium price $P_t$ by substituting $Q_{t}$ and other variables into the demand function \eqref{eq:log_linear_demand}.
We generate 1000 data sets of 100, 200, 1000, 1500 markets.
We jointly estimate the demand and supply parameters by the simultaneous equation model \citep{wooldridge2010econometric} from the true values.
The instrument variables for the demand estimation are $Z^{d}_{t} = (Z^{R}_{t}, Y_t, H_{t}, K_{t})$ and the instrument variables for the supply estimation are $Z^{c}_{t} = (Z^{R}_{t}, W_{t}, R_{t}, Y_t)$. 
We estimate the model using the \texttt{Ipopt.jl} and \texttt{JuMP.jl} packages in \texttt{Julia}.\footnote{Note that we conduct experiments without any constraints, but estimated conduct parameters are implausibly high for both MPEC and N2SLS. That is, explicitly incorporating the constraints is necessary.}

Additional results for different $\sigma$ are shown in Tables \ref{tb:loglinear_loglinear_sigma_0.5_separate_non_constraint_theta_constraint_bias_rmse} and \ref{tb:loglinear_loglinear_sigma_2_mpec_non_constraint_theta_constraint}. 
Also, Table \ref{tb:loglinear_loglinear_sigma_1_simultaneous_non_constraint_non_constraint_bias_rmse} shows that N2SLS without equilibrium constraints searches parameters in the domain where no equilibrium exists and obtains implausible estimated parameters.

\begin{table}[!htbp]
    \caption{True parameters and distributions}
    \label{tb:parameter_setting}
    \begin{center}
    \subfloat[Parameters]{
    \begin{tabular}{crr}
            \hline
            $\alpha_0$  & $20.0$ &\\
            $\alpha_1$ & $1.0$  &\\
            $\alpha_2$ & $0.1$ &\\
            $\alpha_3$ & $1.0$ &\\
            $\gamma_0$ & $5.0$  &\\
            $\gamma_1$ & $1.0$  &\\
            $\gamma_2$ & $1.0$ &\\
            $\gamma_3$ & $1.0$ &\\
            $\theta$ & $0.5$  &\\
            \hline
        \end{tabular}
    }
    \subfloat[Distributions]{
    \begin{tabular}{crr}
            \hline
            Demand shifter&  &  \\
            $Y_t$ & $N(0,1)$ \\
            Demand rotation instrument&  &  \\
            $Z^{R}_{t}$ & $U(0,1)$ \\
            Cost shifter  &  \\
            $W_{t}$ & $U(1,3)$ \\
            $R_t$  & $U(1,3)$  \\
            $H_{t}$ & $W_{t}+U(0,1)$  \\
            $K_{t}$ & $R_{t}+U(0,1)$  \\
            Error&  &  \\
            $\varepsilon^{d}_{t}$ & $N(0,\sigma)$  \\
            $\varepsilon^{c}_{t}$ & $N(0,\sigma)$ \\
            \hline
        \end{tabular}
    }
    \end{center}
    \footnotesize
    Note: $\sigma=\{0.5, 1.0, 2.0\}$. $N:$ Normal distribution. $U:$ Uniform distribution.
\end{table}

% \subsection{Standard Estimation Methods}
% We summarize the results of the standard estimation using a derivative-free optimization algorithm such as Nelder-Mead algorithm and the standard estimation using state-of-the-art constrained optimization solvers, i.e., \texttt{Ipopt.jl} which implements an interior point line search filter method that aims to find a local solution of nonlinear programming problems. 
% First, as mentioned in the main text, the standard simultaneous equation approach using derivative-free algorithms such as Nelder-Mead algorithm could not properly finish the optimization routine to solve the model because the above log-transformation problem arises even if the parameter search starts from the true values. 
% Second, we examine the Two-Stage-Least-Square (2SLS) model in which Ipopt is implemented for minimizing only its supply side moments and the simultaneous equation model in which Ipopt is implemented for minimizing both demand and supply side moments. 
% We refer to the former as separate estimation and the latter as simultaneous estimation.
% These two estimation procedures are considered to be a middle ground between MPEC and standard approaches because these do not use equilibrium constraints but state-of-the-art constrained optimization
% solvers.

% Tables \ref{tb:loglinear_loglinear_sigma_2_separate_non_constraint_theta_constraint_bias_rmse} and \ref{tb:loglinear_loglinear_sigma_1_simultaneous_non_constraint_theta_constraint_bias_rmse} shows that both estimations fail in estimation for about 1\% of the simulation samples even if the parameter search starts from the true values. 
% Also, if $\sigma=2.0$ and $T=1000$, RMSEs are more than 10 for three parameters. Thus, MPEC is better than these approaches even for the typical and simple log-linear model. 



\begin{table}[!htbp]
  \begin{center}
      \caption{MPEC vs standard approaches ($\sigma=0.5$)}
      \label{tb:loglinear_loglinear_sigma_0.5_separate_non_constraint_theta_constraint_bias_rmse} 
      \subfloat[MPEC]{\input{figuretable/loglinear_loglinear_sigma_0.5_mpec_non_constraint_theta_constraint_bias_rmse}}\\
      % \subfloat[Separate]{\input{figuretable/loglinear_loglinear_sigma_0.001_separate_non_constraint_theta_constraint_bias_rmse}}\\
    \subfloat[Simultaneous]{\input{figuretable/loglinear_loglinear_sigma_0.5_simultaneous_non_constraint_theta_constraint_bias_rmse}}
  \end{center}
  \footnotesize
  %Note: 
\end{table} 

\begin{table}[!htbp]
  \begin{center}
      \caption{MPEC vs N2SLS ($\sigma=2.0$)}
      \label{tb:loglinear_loglinear_sigma_2_mpec_non_constraint_theta_constraint} 
      % \subfloat[$\sigma=0.5$]{\input{figuretable/loglinear_loglinear_sigma_0.5_mpec_non_constraint_theta_constraint_bias_rmse}}\\
      \subfloat[MPEC]{\input{figuretable/loglinear_loglinear_sigma_2_mpec_non_constraint_theta_constraint_bias_rmse}}\\
      % \subfloat[Separate]{\input{figuretable/loglinear_loglinear_sigma_1_separate_non_constraint_theta_constraint_bias_rmse}}\\
      \subfloat[Simultaneous]{\input{figuretable/loglinear_loglinear_sigma_2_simultaneous_non_constraint_theta_constraint_bias_rmse}}
    % \subfloat[$\sigma=2.0$]{\input{figuretable/loglinear_loglinear_sigma_2_mpec_non_constraint_theta_constraint_bias_rmse}}
  \end{center}
  \footnotesize
  
\end{table} 


\begin{landscape}{
\begin{table}[!htbp]
  \begin{center}
      \caption{N2SLS without equilibrium constraints}
      \label{tb:loglinear_loglinear_sigma_1_simultaneous_non_constraint_non_constraint_bias_rmse} 
      % \subfloat[$\sigma=0.5$]{\input{figuretable/loglinear_loglinear_sigma_0.5_mpec_non_constraint_theta_constraint_bias_rmse}}\\
      \subfloat[N2SLS ($\sigma=0.5$)]{\input{figuretable/loglinear_loglinear_sigma_0.5_simultaneous_non_constraint_non_constraint_bias_rmse}}\\
      % \subfloat[Separate]{\input{figuretable/loglinear_loglinear_sigma_1_separate_non_constraint_theta_constraint_bias_rmse}}\\
      \subfloat[N2SLS ($\sigma=1.0$)]{\input{figuretable/loglinear_loglinear_sigma_1_simultaneous_non_constraint_non_constraint_bias_rmse}}
    % \subfloat[$\sigma=2.0$]{\input{figuretable/loglinear_loglinear_sigma_2_mpec_non_constraint_theta_constraint_bias_rmse}}
  \end{center}
  \footnotesize
\end{table} 
}
\end{landscape}

\subsection{MPEC for the linear model}

We illustrate that MPEC works for the linear model as in Two-Stage-Least-Square (2SLS) approach in \cite{matsumura2023resolving}. 
% We confirm that the simultaneous equation model in which demand and supply parameters are jointly estimated and 2SLS model in which demand and supply parameters are separately estimated generate the similar results. 
We follow the setting of \cite{matsumura2023resolving}.
We put an additional restriction such that $\theta\in[0,1]$ as a theoretical restriction. 
Table \ref{tb:linear_linear_sigma_2_mpec_linear_non_constraint_theta_constraint_bias_rmse} shows that MPEC estimator reduces bias and RMSE in particular when the sample size is large rather than 2SLS estimator shown in Table \ref{tb:linear_linear_sigma_1}.

\begin{table}[!htbp]
  \begin{center}
      \caption{MPEC Results of the linear model}
      \label{tb:linear_linear_sigma_2_mpec_linear_non_constraint_theta_constraint_bias_rmse} 
      \subfloat[$\sigma=0.5$]{\input{figuretable/linear_linear_sigma_0.5_mpec_linear_non_constraint_theta_constraint_bias_rmse}}\\
      \subfloat[$\sigma=1.0$]{\input{figuretable/linear_linear_sigma_1_mpec_linear_non_constraint_theta_constraint_bias_rmse}}\\
    \subfloat[$\sigma=2.0$]{\input{figuretable/linear_linear_sigma_2_mpec_linear_non_constraint_theta_constraint_bias_rmse}}
  \end{center}
  \footnotesize
  Note: The data generating process follows \cite{matsumura2023resolving}.
\end{table} 


\begin{table}[!htbp]
  \begin{center}
      \caption{2SLS Results of the linear model}
      \label{tb:linear_linear_sigma_1} 
      \subfloat[$\sigma=0.5$]{\input{figuretable/linear_linear_sigma_0.5_bias_rmse.tex}}\\
      \subfloat[$\sigma=1.0$]{\input{figuretable/linear_linear_sigma_1_bias_rmse}}\\
    \subfloat[$\sigma=2.0$]{\input{figuretable/linear_linear_sigma_2_bias_rmse}}
  \end{center}
  \footnotesize
  Note: The data generating process follows \cite{matsumura2023resolving}.
\end{table} 


\newpage

%     \section{Existence of Equilibrium}

% Consider a homogeneous product market where $N$ firms compete with each other.
% There are $N$ firms in the market and firm $j$, $j=1,\ldots, N$, maximizes its profit function with respect to quantity $q_j$.
% Let $P(Q)$ be the inverse demand function where $Q = \sum_{j=1}^N q_j$ is the aggregate demand for the product and $mc_j(q_j)$ be the marginal cost function of firm $j$.

% The profit function of firm $j$ is written as
% \begin{align}
%     \hat{\pi}(q_j,q_{-j}) \equiv \underbrace{P(Q)q_j - \int_0^{q_j} mc_j(q)dq}_{=\pi_j(q_j,q_{-j})} + \kappa_j \sum_{k\ne j} \pi_k(q_k,q_{-k})\label{eq: profit_internalization}.
% \end{align}
% where $\kappa_j\in [0,1]$ is an internalization parameter (Porter 2020).
% The first-order condition for the maximization problem of \eqref{eq: profit_internalization} is
% \begin{align}
%     0 & = \frac{\partial \hat{\pi}(q_j,q_{-j}) }{\partial q_j}\\
%       & = P'(Q)q_j + P(Q) - mc(q_j) + \kappa_j \sum_{k\ne j} P'(Q)q_k\\
%       & = P(Q) - mc(q_j) + P'(Q)\left(q_j + \kappa_j \sum_{k\ne j} q_k\right).
% \end{align}

% The term $\kappa_j \sum_{k\ne j} P'(Q)q_k$ is an additional term to the first-order condition in a normal Cournot competition.
% Then the marginal revenue is 
% \begin{align*}
%     MR(q_j, q_{-j}) & =   P(Q) + P'(Q)\left(q_j + \kappa_j \sum_{k\ne j} q_k\right)\\
%     & =  P(Q) + P'(Q)\left(q_j + \kappa_j Q_{-j}\right)
% \end{align*}

% By dividing the first-order condition by $Q$ and denoting the share of firm $j$ as $s_j = \frac{q_j}{Q}$, we have
% \begin{align}
%     \frac{P(Q) - mc(q_j)}{Q}&= - P'(Q)[s_j + \kappa_j (1- s_j)]\\
%     \frac{P(Q) - mc(q_j)}{P(Q)} \frac{P(Q)}{Q} &= - P'(Q)[s_j + \kappa_j (1- s_j)]\\
%      \frac{P(Q) - mc(q_j)}{P(Q)}  & = - \frac{P'(Q)Q}{P(Q)} [s_j + \kappa_j (1- s_j)]\\
%     L_j & = \frac{\theta_j}{\varepsilon},
% \end{align}
% where $L_j =  \frac{P(Q) - mc(q_j)}{P(Q)} $ is the Lerner index for firm $j$, $\varepsilon = - \frac{P'(Q)Q}{P(Q)}$ is the price elasticity, and $\theta_j = s_j + \kappa_j (1- s_j)$ is a conduct parameter.
% Given a value of the internalization parameter, this conduct parameter does not correspond to a common conduct parameter because the domain of $\theta_j$ is not from zero to one but from $\kappa_j$ to $1$ with respect to the change in the share of firm $j$, $s_j \in [0,1]$.



% \begin{theorem}[Bamon/Fraysee-Novshek Existence]
%     Let $A_j$ be a compact interval of the reals, and suppose that best replies are upper hemicontinuous strongly decreasing correspondence of the type $\Psi_j(\sum_{k\ne j}a_k)$ for all $j$. A fixed point of the best reply map exists. 
% \end{theorem}
% In a Cournot competition model, this existence theorem requires that the marginal revenue is downward-sloping, $\frac{\partial MR_j}{\partial Q_{-j}}<0$.
% In our case, this requires 
% \begin{align}
%     \frac{\partial MR_j}{\partial Q_{-j}} & = P'(Q) + P''(Q)(q_j + \kappa_j Q_{-j}) + \kappa_jP'(Q)\\
%     & = P'(Q) (1 + \kappa_j) + P''(Q)(q_j + \kappa_j Q_{-j})\\
%     & = P'(Q) (1 + \kappa_j) + P''(Q)Q\theta_j.
% \end{align}

% Consider a log-demand function, $\log P = a - b\log Q$. In this case, $P(Q) = \exp(a)Q^{-b}$.
% \begin{align*}
%     P'(Q) &= \exp(a)(-b)Q^{-b-1}\\
%     P''(Q) & = \exp(a)(-b) (-b-1)Q^{-b-2}.
% \end{align*}
% Then
% \begin{align*}
%     \frac{\partial MR_j}{\partial Q_{-j}} &= \exp(a)(-b)Q^{-b-1} (1 + \kappa_j) + \exp(a)(-b) (-b-1)Q^{-b-2} Q \theta_j\\
%     & = \exp(a)(-b)Q^{-b-1} [ 1+\kappa_j - (b+1) \theta_j]
% \end{align*}
% Thus, a downward sloping marginal revenue implies $1+\kappa_j - (b+1) \theta_j > 0$.
% Since $\theta_j = s_j + \kappa_j (1- s_j)$, the left-hand side of the inequality implies
% \begin{align}
%     &(1- s_j)(1+\kappa_j)+ s_j -  (1- s_j)(b+1)\theta_j - s_j\\
%     = & (1-s_j) + \theta_j -  (1- s_j)(b+1)\theta_j - s_j\\
%     = & 1 - 2s_j + \theta_j[1 - (1- s_j)(b+1)] >0.
% \end{align}


\newpage
% \section{Unique existence of equilibrium prices}
% We find the conditions for the unique existence of $P_{t}(>0)$ solving the demand equation \eqref{eq:log_linear_demand} and supply equation \eqref{eq:log_linear_supply_equation} for $P_{t}$ under $\theta\in[0,1]$.
% % \begin{align}
% %     \log P_{t} &= \alpha_0 - (\alpha_1 + \alpha_2 Z^{R}_{t}) \log Q_t + \alpha_3 \log Y_t + \varepsilon^{d}_{t},\\
% %     P_t &= \theta (\alpha_1 + \alpha_2 Z^{R}_{t}) P_t + MC_t\nonumber\\
% %     &=\theta (\alpha_1 + \alpha_2 Z^{R}_{t}) P_t + \exp(\gamma_0 + \gamma_1 \log Q_t +  \gamma_2 \log W_{t} + \gamma_3 \log R_t + \varepsilon^{c}_{t}).
% % \end{align}
% Rewriting the demand equation \eqref{eq:log_linear_demand} as 
% \begin{align*}
%     \log Q_t^*(P_{t})= \frac{\alpha_0 - \log P_{t} + \alpha_3 \log Y_t + \varepsilon^{d}_{t}}{(\alpha_1 + \alpha_2 Z^{R}_{t})}   
% \end{align*}
% and substituting it into the supply equation \eqref{eq:log_linear_supply_equation}, we obtain
% \begin{align}
%     P_t &=\theta (\alpha_1 + \alpha_2 Z^{R}_{t}) P_t + \exp\left(\gamma_0 + \gamma_1 \log Q^*_t(P_{t}) +  \gamma_2 \log W_{t} + \gamma_3 \log R_t + \varepsilon^{c}_{t}\right). \nonumber
% \end{align}
% To find a fixed point of $P_{t}$, we define $\Delta(P_t)$ as follows:
% \begin{align*}
%     \Delta(P_t)
%     %&=P_t -\left(\theta (\alpha_1 + \alpha_2 Z^{R}_{t}) P_t + \exp(\gamma_0 + \gamma_1 \log (\frac{\alpha_0 - \log P_{t} + \alpha_3 \log Y_t + \varepsilon^{d}_{t}}{(\alpha_1 + \alpha_2 Z^{R}_{t})}) +  \gamma_2 \log W_{t} + \gamma_3 \log R_t + \varepsilon^{c}_{t})\right)\\
%     &= [1 - \theta (\alpha_1 + \alpha_2 Z^{R}_{t})]P_t - \exp\left( \gamma_0 + \gamma_1 \log Q_t^*(P_{t}) + \gamma_2 \log W_{t} + \gamma_3 \log R_t + \varepsilon^{c}_{t}\right)
% \end{align*}
% If $\frac{\partial\Delta(P_t)}{\partial P_t}$ is monotonically increasing at any $P_{t}>0$ and $\Delta(\hat{P}_t)\cdot \Delta(\tilde{P}_t)<0$ for $\hat{P}_t < \tilde{P}_t$, then a unique fixed point $P_t$ exists such that $\Delta(P_t)=0$ by the mean value theorem.

% First, when $P_t$ goes to zero, $\Delta P_t$ becomes negative because the first term vanishes and the second term remains.
% When $P_t$ is large, whether $\Delta (P_t)$ is positive depends on the sign of $1 - \theta (\alpha_1 + \alpha_2 Z^{R}_{t})$. 
% %\textcolor{blue}{Note that we have an upper bound on the value of $P_t$ because the demand will be zero for an extremely large price.}
% If $1 - \theta (\alpha_1 + \alpha_2 Z^{R}_{t})<0$, as the second term in $\Delta(P_t)$ is negative, $\Delta(P_t)$ becomes negative, which implies that there is no fixed point and no equilibrium in this model.
% If $1 - \theta (\alpha_1 + \alpha_2 Z^{R}_{t})>0$, $\Delta(P_t)$ becomes positive when $P_{t}$ is enough large.
% Thus, we must hold $1 - \theta (\alpha_1 + \alpha_2 Z^{R}_{t})>0$ as the first condition for the unique existence of $P_{t}$. 

% Second, given the first condition, we find the condition that$\frac{\partial\Delta(P_t)}{\partial P_t}$ is monotonically increasing.
% When this holds, we should have
% \begin{align*}
%     \frac{\partial\Delta(P_t)}{\partial P_t}&=1 - \theta (\alpha_1 + \alpha_2 Z^{R}_{t}) + \exp(C)\gamma_1 \frac{(\alpha_1 + \alpha_2 Z^{R}_{t})}{\alpha_0 - \log P_{t} + \alpha_3 \log Y_t + \varepsilon^{d}_{t}} \frac{1/P_{t}}{(\alpha_1 + \alpha_2 Z^{R}_{t})}\\
%     &=1 - \theta (\alpha_1 + \alpha_2 Z^{R}_{t}) + \frac{\exp(C)}{P_t} \frac{\gamma_1}{\alpha_0 - \log P_{t} + \alpha_3 \log Y_t + \varepsilon^{d}_{t}}\\
%     & >0
% \end{align*}
% where $C=\gamma_0 + \gamma_1 \log Q_t^*(P_{t}) +  \gamma_2 \log W_{t} + \gamma_3 \log R_t + \varepsilon^{c}_{t}$. 
% Given the assumption that the model generates standard downward-sloping demand and upward-sloping marginal cost, we have $\gamma_1 >0$ and $\alpha_0 - \log P_{t} + \alpha_3 \log Y_t + \varepsilon^{d}_{t} >0$. 
% Then, we have $\frac{\gamma_1}{\alpha_0 - \log P_{t} + \alpha_3 \log Y_t + \varepsilon^{d}_{t}}>0$, which guarantees that $\frac{\partial\Delta(P_t)}{\partial P_t}$ is monotonically increasing.


% Since the above condition must hold for all $\theta\in[0,1]$, $\frac{\partial \Delta (P_t)}{\partial P_t} >0$ holds if and only if $\frac{\gamma_1}{\alpha_0 - \log P_{t} + \alpha_3 \log Y_t + \varepsilon^{d}_{t}}>0$. 
%ここから先を編集する必要あり
% Since $C$ is large enough based on the marginal cost specification, the necessary condition is $\frac{\gamma_1}{\alpha_0 - \log P_{t} + \alpha_3 \log Y_t + \varepsilon^{d}_{t}}>0$.
% To search the conduct parameter over any $\theta\in [0,1]$, at least this condition must hold. 

%Third, given the assumption that the model generates standard downward-sloping demand and upward-sloping marginal cost, i.e., $\gamma_1>0$ hold. 
%To show an unreasonable behavior, suppose $\gamma_1<0$. 
%Then, $\alpha_0 - \log P_{t} + \alpha_3 \log Y_t + \varepsilon^{d}_{t}<0$ so $(\alpha_1 + \alpha_2 Z^{R}_{t})<0$ in $\log Q_t^{*}(P_{t})$ to get sufficiently large quantities. This gives the upward-sloping demand curve which is verified only for Giffen goods. 
%Given this, the second condition leads to $\alpha_0 - \log P_{t} + \alpha_3 \log Y_t + \varepsilon^{d}_{t}>0$. Whether this condition is satisfied depends on demand shifter $\log Y_t$. In our numerical setting, since $Y$ is i.i.d. drawn from $N(0,1)$, $\alpha_0<0$ must violate the condition, so we need to impose $\alpha_0>0$. Note that if $\gamma_1>0$ and $\alpha_0>0$, then the above second condition holds.
%\textcolor{blue}{Second, $\gamma_0\ge 0$ because }


% In summary, if $1- \theta(\alpha_1 + \alpha_2 Z_{t}^{R}) >0$, and $\alpha_0 - \log P_{t} + \alpha_3 \log Y + \epsilon_{t}^{d} > 0$, then $P_{t}$ exists uniquely for all market $t$. MPEC needs to explicitly incorporate the conditions to avoid searching over implausible parameter domains.




\end{document}